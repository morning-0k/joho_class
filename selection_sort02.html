<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>選択ソート・改良版 可視化ツール</title>
    <!-- Tailwind CSSを読み込み -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Interフォントを読み込み -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Noto Sans JPをInterより優先的に適用 */
        body {
            font-family: 'Noto Sans JP', 'Inter', sans-serif;
        }
        /* カードのスタイル */
        .card {
            width: 5rem; /* 80px */
            height: 7rem; /* 112px */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.25rem; /* 36px */
            font-weight: 700;
            border-width: 2px;
            border-radius: 0.5rem; /* 8px */
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: all 0.3s ease-in-out;
            background-color: white;
        }
        /* 説明文の改行を有効にする */
        #explanation {
            white-space: pre-wrap;
            min-height: 4.5rem; /* 3行分程度の高さを確保 */
        }
        
        /* 状態ごとのスタイル */
        .card.sorted {
            /* ソート済み */
            background-color: #d1fae5; /* green-100 */
            border-color: #6ee7b7; /* green-300 */
            color: #065f46; /* green-800 */
        }
        .card.target {
            /* 現在の交換対象（i番目） */
            border-color: #60a5fa; /* blue-400 */
            transform: scale(1.05);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .card.min {
            /* 未ソート部分の最小値候補（minIndex番目） */
            border-color: #c084fc; /* purple-400 */
            transform: scale(1.05);
        }
        .card.checking {
            /* 現在調査中の要素（j番目） */
            border-color: #facc15; /* yellow-400 */
            background-color: #fef9c3; /* yellow-50 */
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <div class="bg-white p-6 sm:p-8 rounded-xl shadow-2xl max-w-2xl w-full">
        
        <h1 class="text-2xl sm:text-3xl font-bold text-center text-gray-800 mb-6">
            選択ソート 可視化ツール・改良版
        </h1>

        <!-- カードを表示するコンテナ -->
        <div id="card-container" class="flex justify-around items-center my-8 sm:my-12 px-2">
            <!-- JavaScriptでカードがここに追加されます -->
        </div>

        <!-- コントロールボタン -->
        <div class="flex justify-center gap-4 mb-6">
            <button id="reset-button" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-6 rounded-lg shadow-md transition-all">
                リセット
            </button>
            <button id="next-button" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg shadow-md transition-all">
                次へ
            </button>
        </div>

        <!-- 説明文 -->
        <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
            <h2 class="font-bold text-lg text-gray-700 mb-2">現在のステップ</h2>
            <p id="explanation" class="text-gray-600 text-sm sm:text-base"></p>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const cardContainer = document.getElementById('card-container');
            const nextButton = document.getElementById('next-button');
            const resetButton = document.getElementById('reset-button');
            const explanation = document.getElementById('explanation');

            let cards = [];
            let i = 0; // 外側ループのインデックス（ソート済みの次の位置）
            let j = 1; // 内側ループのインデックス（最小値を探すため）
            let minIndex = 0; // 最小値のインデックス
            let isFinding = true; // 最小値を探しているフェーズか
            let isDone = false; // ソートが完了したか
            
            const INITIAL_CARDS = [12, 7, 16, 3, 10]; // 固定の初期配列
            // const INITIAL_CARDS = [5, 2, 4, 1, 3]; // 固定の初期配列

            // 初期化・リセット処理
            function initialize() {
                cards = [...INITIAL_CARDS];
                i = 0;
                j = 1;
                minIndex = 0;
                isFinding = true;
                isDone = false;
                nextButton.disabled = false;
                updateExplanation("初期状態です。「次へ」を押してソートを開始します。\n[青枠]が交換対象、[紫枠]が最小値候補です。");
                renderCards();
            }

            // カードを描画する処理
            function renderCards() {
                cardContainer.innerHTML = ''; // コンテナをクリア
                cards.forEach((value, index) => {
                    const card = document.createElement('div');
                    card.className = 'card';
                    card.textContent = value;

                    // 状態に応じてスタイルを適用
                    if (isDone || index < i) {
                        // ソート完了
                        card.classList.add('sorted');
                    } else if (!isDone) {
                        if (index === i) {
                            card.classList.add('target'); // 交換対象
                        }
                        if (index === minIndex) {
                            card.classList.add('min'); // 最小値候補
                        }
                        if (isFinding && index === j) {
                            card.classList.add('checking'); // 調査中
                        }
                    }
                    cardContainer.appendChild(card);
                });
            }

            // 説明文を更新する処理
            function updateExplanation(text) {
                explanation.textContent = text;
            }

            // 「次へ」ボタンが押されたときの処理
            function nextStep() {
                if (isDone) return;

                // ソートが完了したかチェック (iが最後の手前まで行ったら)
                if (i >= cards.length - 1) {
                    isDone = true;
                    nextButton.disabled = true;
                    updateExplanation("ソートが完了しました！");
                    renderCards(); // 最後の要素もソート済みとして表示
                    return;
                }

                if (isFinding) {
                    // --- 最小値を探すフェーズ ---
                    if (j < cards.length) {
                        updateExplanation(
                            `[${i + 1}番目]以降で最小値を探しています...\n`+
                            `[${j + 1}番目]の値(${cards[j]})と、現在の最小値候補(${cards[minIndex]})を比較します。`
                        );
                        
                        if (cards[j] < cards[minIndex]) {
                            // 最小値候補を更新
                            minIndex = j;
                            // 状態を更新してすぐ描画（最小値候補の枠が移動する）
                            renderCards();
                            // 説明文も更新
                            updateExplanation(
                                `最小値候補を[${j + 1}番目]の値(${cards[j]})に更新しました。`
                            );
                        }
                        j++; // 次の要素へ
                    } else {
                        // 内側ループが終了（jが配列の最後まで達した）
                        isFinding = false;
                        
                        if(i === minIndex) {
                             updateExplanation(
                                `[${i + 1}番目]（${cards[i]}）が最小値でした。\n交換は不要です。`
                            );
                        } else {
                            updateExplanation(
                                `未ソート部分の最小値は ${cards[minIndex]} です。\n`+
                                `[${i + 1}番目]の値(${cards[i]})と交換します。`
                            );
                        }
                    }
                } else {
                    // --- 交換フェーズ ---
                    if (i !== minIndex) {
                        // 値を交換
                        [cards[i], cards[minIndex]] = [cards[minIndex], cards[i]];
                        updateExplanation(
                            `${cards[minIndex]} と ${cards[i]} を交換しました。\n`+
                            `[${i + 1}番目]の位置が ${cards[i]} で確定しました。`
                        );
                    }
                    
                    // 次の外側ループの準備
                    i++;
                    j = i + 1;
                    minIndex = i;
                    isFinding = true;
                    
                    // もしiが配列の最後まできてたら、この時点で完了を宣言
                    if (i >= cards.length - 1) {
                        isDone = true;
                        nextButton.disabled = true;
                        updateExplanation(
                            `ソートが完了しました！`
                        );
                    }
                }

                renderCards(); // 各ステップの最後に必ず描画
            }

            // イベントリスナーを設定
            nextButton.addEventListener('click', nextStep);
            resetButton.addEventListener('click', initialize);

            // 初期化
            initialize();
        });
    </script>
</body>
</html>